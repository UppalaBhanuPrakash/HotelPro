<div class="container-fluid py-4 bg-light min-vh-100">
  <div class="d-flex justify-content-between align-items-center flex-wrap gap-3 mb-4">
    <div>
      <h1 class="h3 text-primary fw-bold mb-1" style=" font-size: 2.5rem;
      font-weight: 700;
      color: #1e293b;
      margin-bottom: 8px;">Booking Management</h1>
      <p class="text-muted mb-0">Manage reservations and guest bookings</p>
    </div>
    <button class="btn btn-primary" (click)="showAddModal = true">
      üìã New Booking
    </button>
  </div>
  <div class="position-fixed top-0 end-0 p-3" style="z-index: 1055">
  <div class="toast align-items-center text-white bg-success border-0" 
       role="alert" 
       aria-live="assertive" 
       aria-atomic="true"
       #bookingToast>
    <div class="d-flex">
      <div class="toast-body">
        Booking completed successfully!
      </div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto" 
              data-bs-dismiss="toast" 
              aria-label="Close"></button>
    </div>
  </div>
</div>

  <div class="row g-4 mb-4">
    <div class="col-md-3">
      <div class="card stat-card pending p-3">
        <h3 class="fw-bold mb-1">{{ pendingCount }}</h3>
        <p class="mb-0">Pending</p>
      </div>
    </div>

    <div class="col-md-3">
      <div class="card stat-card confirmed p-3">
        <h3 class="fw-bold mb-1">{{ confirmedCount }}</h3>
        <p class="mb-0">Confirmed</p>
      </div>
    </div>

    <div class="col-md-3">
      <div class="card stat-card completed p-3">
        <h3 class="fw-bold mb-1">{{ completedCount }}</h3>
        <p class="mb-0">Completed</p>
      </div>
    </div>

    <div class="col-md-3">
      <div class="card stat-card total-revenue p-3">
        <h3 class="fw-bold mb-1">‚Çπ{{ totalRevenue }}</h3>
        <p class="mb-0">Total Revenue</p>
      </div>
    </div>
  </div>

  <div class="row g-4">
    <div class="col-12" *ngFor="let booking of bookings">
      <div class="card booking-card p-3" [ngClass]="booking.status">
        <div class="d-flex justify-content-between align-items-start mb-2">
          <div>
            <h5 class="fw-bold mb-1">{{ booking.guestName }}</h5>
            <p class="mb-0 text-muted">Room {{ booking.roomNumber }}</p>
          </div>
          <div class="d-flex gap-2">
            <button class="action-btn edit border-0" (click)="editBooking(booking)">
              ‚úèÔ∏è
            </button>
            <button class="action-btn status border-0" (click)="updateBookingStatus(booking)">
              üîÑ
            </button>
          </div>
        </div>

        <div class="d-flex justify-content-between mb-2">
          <div>
            <small class="text-muted">CHECK-IN:</small>
            <p class="mb-0">{{ booking.checkIn | date:'MMM d, yyyy' }}</p>
          </div>
          <div>
            <small class="text-muted">CHECK-OUT:</small>
            <p class="mb-0">{{ booking.checkOut | date:'MMM d, yyyy' }}</p>
          </div>
          <div>
            <small class="text-muted">NIGHTS:</small>
            <p class="mb-0">{{ calculateNights(booking.checkIn, booking.checkOut) }}</p>
          </div>
        </div>

        <div class="d-flex justify-content-between align-items-center mt-2">
          <span class="badge status-badge" [ngClass]="booking.status">
            {{ booking.status.toUpperCase() }}
          </span>
          <div class="text-end">
            <p class="mb-0 text-success fw-bold">
              Remaining: ${{ getRemainingAmount(booking) }}
            </p>
            <p class="mb-0 text-success fw-bold">
              Total: ${{ booking.totalAmount }}
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>

<div class="modal fade show d-block" tabindex="-1" *ngIf="showAddModal || showEditModal">
  <div class="modal-dialog modal-lg">
    <div class="modal-content shadow rounded-4">
      <div class="modal-header">
        <h5 class="modal-title">{{ showAddModal ? 'New Booking' : 'Edit Booking' }}</h5>
        <button type="button" class="btn-close" (click)="closeModal()"></button>
      </div>

      <form (ngSubmit)="saveBooking()">
        <div class="modal-body row g-3">
         
          <div class="col-md-6">
            <label class="form-label">Guest</label>
            <select [(ngModel)]="currentBooking.guestId"
                    name="guestId"
                    class="form-select"
                    (change)="onGuestChange()">
              <option *ngFor="let g of guests" [ngValue]="g.id">{{ g.name }}</option>
            </select>
          </div>

          <div class="col-md-6">
            <label class="form-label">Room</label>
            <select [(ngModel)]="currentBooking.roomId"
                    name="roomId"
                    class="form-select"
                    (change)="onRoomChange(); calculateTotal(); onAdvanceChange()">
              <option *ngFor="let r of availableRooms" [ngValue]="r.id">
                {{ r.number }} - {{ r.type }}
              </option>
            </select>
          </div>

          <div class="col-md-6">
            <label class="form-label">Check-in</label>
            <input type="date" class="form-control"
                   [(ngModel)]="checkInDate"
                   name="checkInDate"
                   [min]="today"
                   (change)="onCheckInChange(); calculateTotal(); onAdvanceChange()">
          </div>

          
          <div class="col-md-6">
            <label class="form-label">Check-out</label>
            <input type="date" class="form-control"
                   [(ngModel)]="checkOutDate"
                   name="checkOutDate"
                   [min]="minCheckoutDate"
                   (change)="onCheckOutChange(); calculateTotal(); onAdvanceChange()">
            <small class="text-danger" *ngIf="checkoutError">Checkout date must be after check-in.</small>
          </div>

          <div class="col-md-4">
            <label class="form-label">Advance Paid</label>
            <input type="number" class="form-control"
                   [(ngModel)]="currentBooking.advancePaid"
                   name="advancePaid"
                   (input)="onAdvanceChange()">
          </div>
          <div class="col-md-4">
            <label class="form-label">Remaining</label>
            <input type="number" class="form-control"
                   [value]="currentBooking.remainingAmount"
                   disabled>
          </div>

          <div class="col-md-4">
            <label class="form-label">Total</label>
            <input type="number" class="form-control"
                   [value]="currentBooking.totalAmount"
                   disabled>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" (click)="closeModal()">Cancel</button>
          <button type="submit" class="btn btn-primary">{{ showAddModal ? 'Create' : 'Save' }}</button>
        </div>
      </form>
    </div>
  </div>
</div>
